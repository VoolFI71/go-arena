Go Arena: High-Performance Zero-GC Allocator

Go Arena ‚Äî —ç—Ç–æ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏ –¥–ª—è Go, –∫–æ—Ç–æ—Ä—ã–π —è –¥–µ–ª–∞–ª –ø–æ–¥ –∑–∞–¥–∞—á–∏ —Å –∂–µ—Å—Ç–∫–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º (C10M, HFT, GameDev). –ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞—è: –≤–º–µ—Å—Ç–æ —á–∞—Å—Ç—ã—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π –≤ heap –∏ —Ç—è–∂–µ–ª–æ–≥–æ GC –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞—Ä–µ–Ω—É —Å bump-pointer, –∞ –∑–∞—Ç–µ–º —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –µ–µ –∑–∞ O(1). –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ GC –ø–æ—á—Ç–∏ –Ω–µ –≤–∏–¥–∏—Ç ¬´–º–µ–ª–∫–∏–π –º—É—Å–æ—Ä¬ª, –∞ –∑–∞–¥–µ—Ä–∂–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –±–æ–ª–µ–µ —Ä–æ–≤–Ω—ã–º–∏.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–ù–∏–∂–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –º–æ–µ–≥–æ —Ç–µ—Å—Ç–∞ —Å ¬´—Ç—è–∂–µ–ª–æ–π¬ª –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏ —Ñ–æ–Ω–æ–≤—ã–º –¥–∞–≤–ª–µ–Ω–∏–µ–º –Ω–∞ –∫—É—á—É (5,000,000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏). –≠—Ç–æ –Ω–µ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π –±–µ–Ω—á–º–∞—Ä–∫, –∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –∫—É—á–∞ ¬´–∂–∏–≤–µ—Ç¬ª, –∞ —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–¥—Ç–∏.

–£—Å–ª–æ–≤–∏—è —Ç–µ—Å—Ç–∞:
- –û–±—ä–µ–º: 1,000,000 POST-–∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤).
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å: 100 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (hey).
- –°—Ä–µ–¥–∞: Windows 10/11, Go 1.24+.

| –ú–µ—Ç—Ä–∏–∫–∞ | Standard Heap | Go Arena | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|---|---|---|
| Throughput (–°–∫–æ—Ä–æ—Å—Ç—å) | 53,251 RPS | 104,454 RPS | x2 –ë—ã—Å—Ç—Ä–µ–µ |
| Max Latency (Slowest) | 378 ms | 72 ms | –í 5.2 —Ä–∞–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ |
| 99th Percentile (p99) | 5.6 ms | 2.5 ms | –í 2.2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –ª–∞–≥ |
| GC Scan Time | –í—ã—Å–æ–∫–∏–π (ms) | –ë–ª–∏–∑–∫–∏–π –∫ 0 (¬µs) | Zero-GC Pressure |

> –í—ã–≤–æ–¥: –∫–æ–≥–¥–∞ heap –∑–∞–±–∏—Ç –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤, GC —Ç—Ä–∞—Ç–∏—Ç –∑–∞–º–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –ê—Ä–µ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–Ω–µ—Å—Ç–∏ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è GC –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤.

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- Zero Allocation: 0 –±–∞–π—Ç –º—É—Å–æ—Ä–∞ –≤ heap –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–∏–ø–∏—á–Ω—ã—Ö DTO –∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- O(1) Allocation & Reset: –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ ‚Äî —ç—Ç–æ —Å–¥–≤–∏–≥ —É–∫–∞–∑–∞—Ç–µ–ª—è, –∞ –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π –∞—Ä–µ–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.
- Generic API: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤ Go (—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Å–ª–∞–π—Å—ã).
- Arena Pool: –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏/–∑–∞–ø—Ä–æ—Å–∞–º–∏.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
–£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```
go get github.com/VoolFI71/go-arena
```

## üõ† –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
### 1. HTTP / TCP —Å–µ—Ä–≤–µ—Ä (–ø–∞—Ç—Ç–µ—Ä–Ω "Arena Pool")
–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ArenaPool, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.

```go
package main

import (
    "fmt"
    "github.com/VoolFI71/go-arena"
)

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—É–ª. 64KB –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.
var pool = arena.NewArenaPool(64*1024, 0)

func HandleLog(ctx *fasthttp.RequestCtx) {
    // 1. –ü–æ–ª—É—á–∞–µ–º –∞—Ä–µ–Ω—É –∏–∑ –ø—É–ª–∞
    mem := pool.Get()
    defer pool.Put(mem)

    // 2. –ê–ª–ª–æ—Ü–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –∞—Ä–µ–Ω–µ
    u := arena.New[UserData](mem)

    // 3. –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π –≤ heap
    u.Name = mem.AllocString(string(ctx.PostBody()))

    ctx.SetStatusCode(200)
}
```

### 2. –†–∞–±–æ—Ç–∞ —Å–æ —Å–ª–∞–π—Å–∞–º–∏ (MakeSlice + Append)
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–æ–≥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ append —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∞—Ä–µ–Ω—ã.

```go
// 4. –†–∞–±–æ—Ç–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
func DynamicWork(mem *arena.Arena) {
    // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ª–∞–π—Å –≤ –∞—Ä–µ–Ω–µ
    items := arena.MakeSlice[int](mem, 0, 10)

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º arena.Append –≤–º–µ—Å—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ append
    for i := 0; i < 100; i++ {
        items = arena.Append(mem, items, i)
    }
    // –î–∞–∂–µ –µ—Å–ª–∏ —Å–ª–∞–π—Å –≤—ã—Ä–∞—Å—Ç–µ—Ç –≤ 10 —Ä–∞–∑, –≤—Å–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∞—Ä–µ–Ω—ã
}
```

### 3. –°–±—Ä–æ—Å –∞—Ä–µ–Ω—ã –≤ —Ü–∏–∫–ª–µ (Reset)
–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–æ–ª–≥–∏—Ö —Ü–∏–∫–ª–æ–≤ –≤ –æ–¥–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ –±–µ–∑ –ø—É–ª–∞.

```go
func Worker() {
    mem := arena.NewArena(1024*1024, 0) // –ê—Ä–µ–Ω–∞ –Ω–∞ 1MB

    for i := 0; i < 1000; i++ {
        processIteration(mem)
        mem.Reset() // –û—á–∏—â–∞–µ–º –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é –∑–∞ O(1)
    }
}
```

## ‚ö†Ô∏è The Safety Contract (–í–∞–∂–Ω–æ!)
–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é —Ç—Ä–µ–±—É–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã. –ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ:
- Scope Limit: –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã –∏–∑ –∞—Ä–µ–Ω—ã –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –µ–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ (–ø–æ—Å–ª–µ pool.Put –∏–ª–∏ Reset).
- Concurrency: –æ–±—ä–µ–∫—Ç Arena –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω. –î–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ArenaPool.
- Data Independence: –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞—Ä–µ–Ω—ã –Ω—É–∂–Ω—ã –¥–ª—è –¥–æ–ª–≥–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî —Å–¥–µ–ª–∞–π—Ç–µ –∏—Ö –∫–æ–ø–∏—é (—Å–µ—Ä–∏–∞–ª–∏–∑—É–π—Ç–µ).

### üö´ –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (—Ç–∞–∫ –¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è)
```go
// ‚ùå –û–®–ò–ë–ö–ê: –í–æ–∑–≤—Ä–∞—Ç —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –ø–∞–º—è—Ç—å –∞—Ä–µ–Ω—ã –Ω–∞—Ä—É–∂—É
func BadFunction() *User {
    mem := pool.Get()
    defer pool.Put(mem) // –ü–∞–º—è—Ç—å –æ—á–∏—Å—Ç–∏—Ç—Å—è –∑–¥–µ—Å—å!

    u := arena.New[User](mem)
    return u // <--- DANGER! Caller –ø–æ–ª—É—á–∏—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º—É—Å–æ—Ä.
}

// ‚ùå –û–®–ò–ë–ö–ê: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ä–µ–Ω—ã –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö
func AsyncLogic(mem *arena.Arena) {
    go func() {
        // Arena –ù–ï –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞ (–∫—Ä–æ–º–µ Pool).
        // –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –≥–æ–Ω–∫—É –¥–∞–Ω–Ω—ã—Ö (Race Condition).
        _ = arena.New[int](mem)
    }()
}
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
```go
// ‚úÖ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑—É–π—Ç–µ –∏—Ö
func GoodFunction() []byte {
    mem := pool.Get()
    defer pool.Put(mem)

    u := arena.New[User](mem)
    // ... –∑–∞–ø–æ–ª–Ω—è–µ–º u ...

    return json.Marshal(u) // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ø–∏—é –±–∞–π—Ç, –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –æ—Ç –∞—Ä–µ–Ω—ã
}
```

## API Reference
### –ê–ª–ª–æ–∫–∞—Ç–æ—Ä—ã
- `New[T](a *Arena) *T` ‚Äî —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ T –≤ –∞—Ä–µ–Ω–µ.
- `MakeSlice[T](a *Arena, len, cap int) []T` ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Å–ª–∞–π—Å.
- `AllocString(s string) string` ‚Äî –∫–æ–ø–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É/–±–∞–π—Ç—ã –≤ –∞—Ä–µ–Ω—É.

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `Append(a *Arena, slice []T, items ...T) []T` ‚Äî –∞–Ω–∞–ª–æ–≥ append, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤–Ω—É—Ç—Ä–∏ –∞—Ä–µ–Ω—ã.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- `NewArenaPool(chunkSize, maxRetained int) *ArenaPool` ‚Äî —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É–ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).
- `Reset()` ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π –ø–∞–º—è—Ç–∏ –∞—Ä–µ–Ω—ã (–∫—É—Ä—Å–æ—Ä -> 0).

## –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º (Architecture)
Go Arena –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –ø–∞–º—è—Ç–∏ ([][]byte).
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—ã–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —á–∞–Ω–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 64KB).
- New[T] –ø—Ä–æ—Å—Ç–æ —Å–¥–≤–∏–≥–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å offset –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —á–∞–Ω–∫–∞.
- –ï—Å–ª–∏ –º–µ—Å—Ç–æ –≤ —á–∞–Ω–∫–µ –∫–æ–Ω—á–∞–µ—Ç—Å—è, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è–µ—Ç –Ω–æ–≤—ã–π —á–∞–Ω–∫ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–∏—Å–∞—Ç—å –≤ –Ω–µ–≥–æ.
- Reset –Ω–µ —É–¥–∞–ª—è–µ—Ç —á–∞–Ω–∫–∏, –∞ –ø—Ä–æ—Å—Ç–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã, –ø–æ–∑–≤–æ–ª—è—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å.
> –°–æ–≤–µ—Ç: –≤—ã–±–∏—Ä–∞–π—Ç–µ chunkSize –≤ ArenaPool —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –ø–æ–∫—Ä—ã–≤–∞–ª 90% –≤–∞—à–∏—Ö —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π –Ω–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤.


## License
MIT
